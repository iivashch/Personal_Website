<%- include('partials/header', { title: 'Create Post' }) %>
<div class="container mt-5">
  <h1>Create a New Post</h1>
  <form action="/posts" method="POST">
    <div class="mb-3">
      <label for="title" class="form-label">Title</label>
      <input type="text" class="form-control" id="title" name="title" required>
    </div>
    <div class="mb-3">
      <label for="content" class="form-label">Content</label>
      <textarea id="content" name="content"></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Create Post</button>
  </form>
</div>

<!-- SimpleMDE CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simplemde/dist/simplemde.min.css">
<!-- KaTeX CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">

<!-- KaTeX + auto-render -->
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js"></script>
<!-- SimpleMDE JS -->
<script src="https://cdn.jsdelivr.net/npm/simplemde/dist/simplemde.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var simplemde = new SimpleMDE({
      element: document.getElementById("content"),
      previewRender: function(plainText) {
        // 1) Markdown â†’ HTML
        var html = this.parent.markdown(plainText);

        // 2) Render math in a temporary container
        var container = document.createElement("div");
        container.innerHTML = html;
        renderMathInElement(container, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "\\[", right: "\\]", display: true },
            { left: "$",  right: "$",  display: false },
            { left: "\\(", right: "\\)", display: false }
          ],
          throwOnError: false
        });

        // 3) Return rendered HTML
        return container.innerHTML;
      }
    });
  });
</script>

<%- include('partials/footer') %>
