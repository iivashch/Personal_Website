<%- include('partials/header', { title: post.title }) %>

<!-- KaTeX CSS for math rendering -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">

<div class="container mt-5">
  <h1><%= post.title %></h1>
  <p>By <%= post.author.username %> on <%= post.createdAt.toDateString() %></p>

  <!-- Rendered Markdown content -->
  <div class="markdown-content"><%- marked.parse(post.content) %></div>

  <% if (user && user._id.equals(post.author._id)) { %>
    <a href="/posts/<%= post._id %>/edit" class="btn btn-warning">Edit</a>
    <form action="/posts/<%= post._id %>?_method=DELETE" method="POST" class="d-inline">
      <button type="submit" class="btn btn-danger">Delete</button>
    </form>
  <% } %>
</div>

<!-- KaTeX JS and auto-render plugin -->
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var content = document.querySelector('.markdown-content');
    if (content) {
      renderMathInElement(content, {
        delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '\\[', right: '\\]', display: true },
          { left: '$',  right: '$',  display: false },
          { left: '\\(', right: '\\)', display: false }
        ],
        throwOnError: false
      });
    }
  });
</script>

<%- include('partials/footer') %>
