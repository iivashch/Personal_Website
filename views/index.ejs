<%- include('partials/header', { title: 'Home' }) %>
<div class="container mt-5">
  <h1>Welcome to Express Blog</h1>
  <% if (posts && posts.length > 0) { %>
    <div class="list-group">
      <% posts.forEach(post => { %>
        <a href="/posts/<%= post._id %>" class="list-group-item list-group-item-action">
          <h5><%= post.title %></h5>
          <small>By <%= post.author.username %> on <%= post.createdAt.toDateString() %></small>
        </a>
      <% }) %>
    </div>
  <% } else { %>
    <p>No posts found.</p>
  <% } %>
</div>

<% if (query && query.registered === 'pending') { %>
  <div class="modal fade show" id="pendingModal" tabindex="-1" style="display: block;" aria-modal="true" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-warning">
          <h5 class="modal-title">Account Created</h5>
          <button type="button" class="btn-close" onclick="closeModal()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Your account has been created and is <strong>pending administrator approval</strong>.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">OK</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop fade show"></div>

  <script>
    function closeModal() {
      document.getElementById('pendingModal').style.display = 'none';
      document.querySelector('.modal-backdrop').remove();
      window.history.replaceState(null, null, window.location.pathname); // remove ?registered param
    }
  </script>
<% } %>



<%- include('partials/footer') %>